<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <title>Keyword Checker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px;
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding-top: 20px;
        }

        .container {
            display: flex;
            margin-bottom: 10px;
        }

        .keyword-container {
            width: 15%;
            box-sizing: border-box;
            border: 2px solid black;
            height: 650px;
            padding: 10px;
            margin-right: 10px;
            display: flex;
            flex-direction: column;
        }

        #keywords {
            width: calc(100% - 20px);
            height: calc(100% - 70px);
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        .check-button {
            width: calc(100% - 20px);
            padding: 10px;
            font-size: 16px;
        }

        .stats-container {
            width: 15%;
            box-sizing: border-box;
            border: 2px solid black;
            padding: 10px;
            margin-right: 10px;
            display: flex;
            flex-direction: column;
        }

        .quill-container {
            width: 48%;
            border: 2px solid black;
            min-height: auto;
            margin-right: 10px;
        }

        .results-container {
            width: 35%;
            box-sizing: border-box;
            border: 2px solid black;
            padding: 10px;
            margin-right: 10px;
            position: relative;
			overflow: auto;
			min-height: 1250px;
        }

        .results-container.sticky {
            position: fixed;
            max-height: calc(100vh - 20px);
            overflow-y: auto;
            right: 0;
        }

        .results-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .results-title button {
            font-size: 12px;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
            cursor: pointer;
        }

        th:hover,
        td:hover {
            background-color: #f1f1f1;
        }

        .highlight-yellow {
            background-color: yellow;
        }

        .highlight-green {
            background-color: green;
        }
		
		.how-to-use-container {
			text-align: center;
			margin-bottom: 20px;
		}

		.how-to-use-button {
			font-size: 16px;
			padding: 10px 20px;
			cursor: pointer;
		}

		.instructions {
			display: none;
			margin-top: 10px;
			border: 2px solid black;
			padding: 10px;
		}

		.instructions.show {
			display: block;
			text-align: left;
		}
		
		.stats, p {
			text-align: left;
		}
	
		.return-to-top-button {
            position: fixed;
            font-size: 16px;
            bottom: 10px; /* Adjust as needed */
            left: 10px; /* Adjust as needed */
            padding: 10px 20px;
            cursor: pointer;
            background-color: #cae8ca;
            border: 2px solid #4CAF50;
            z-index: 1;
        }
		
		#clear-results-button {
			background-color: #FF6865;
		}
		
		#sticky-button, #clear-results-button {
			padding: 5px;
		}
		
		button {
			background-color: #32CD32;
			font-weight: 500;
			border-radius: 12px;
		}

    </style>
</head>

<body>
    <div class="how-to-use-container">
    <button class="how-to-use-button" onclick="toggleInstructions()">How to use</button>
    <div class="instructions" id="instructions">
        <h2>How to use:</h2>
        <ol>
            <li>Paste the list of keywords into the "Keywords" field (1 keyword, 1 line. No space after the keyword)</li>
            <li>Paste the text into the editor</li>
            <li>Click on "Check Keywords"</li>
			<li>To check another text, click on "Clear Results" to delete everything</li>
        </ol>
		<h2>Note:</h2>
		<ul>
			<li>Total Instances = exact keyword match</li>
			<li>Partial Matches = keywords with slight modifications (eg, KW="casino", partial match="casinos")</li>
			<li>It checks for trailing spaces after the keywords and, if present, it prompts to fix them automatically (not doing so could give wrong results)</li>
			<li>In Stats, Used KWs is the number of keywords used at least once. % used is the percentage of keywords used at least once compared to the total number.</li>
			<li>Keyword check isn't case sensitive and works with all alphabets</li>
		</ul>
    </div>
	
	<div class="container">
        <div class="keyword-container">
            <h2>Keywords</h2>
            <textarea id="keywords"></textarea>
            <button class="check-button" onclick="checkKeywords()">Check Keywords</button>
            <h2 class="stats">Stats</h2>
				<p>Total number of keywords: <span id="totalKeywords">0</span></p>
				<p>Used KWs: <span id="usedKeywords">0</span></p>
				<p>% used: <span id="percentageKeywords">0%</span></p>
				<p>Unused KWs: <span id="unusedKeywords">0</span></p>
					<button class="return-to-top-button" onclick="returnToTop()">Return to top</button>
        </div>
        <div class="quill-container">
            <div id="editor" class="quill-editor"></div>
        </div>
        <div class="results-container" id="resultsContainer">
            <div class="results-title">
                <h2>Keyword Results</h2>
				<button id="clear-results-button" onclick="clearResults()">Clear Results</button>
                <button id="sticky-button" onclick="toggleSticky()">Stick List</button>
            </div>
            <table class="results-table" id="resultsTable">
                <thead>
                    <tr>
                        <th>Keyword</th>
                        <th title="Exact KW matches">Total Instances</th>
                        <th title="KWs with slight differences (eg. 'book' - 'books')">Partial Matches</th>
                        <th title="Density considers exact and partial matches">Density</th>
                    </tr>
                </thead>
                <tbody id="results"></tbody>
            </table>
        </div>
</div>

    </div>

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        var totalInstancesHighlighted = false;
        var partialMatchesHighlighted = false;
        var stickyEnabled = false;
		var currentHighlightedKeyword = null;

		var quill = new Quill('#editor', {
			theme: 'snow',
			placeholder: 'Insert your text here...',
			modules: {
				toolbar: [
					[{ 'font': [] }],
					[{ 'size': ['small', false, 'large', 'huge'] }],
					[{ 'header': [1, 2, 3, 4, 5, 6, false] }],
					['bold', 'italic', 'underline', 'strike'],
					['link', 'image', 'video'],
					[{ 'list': 'ordered'}, { 'list': 'bullet' }],
				]
			}
		});

		var Size = Quill.import('attributors/style/size');
		Size.whitelist = ['14px', '16px', '18px', '24px']; // Define the sizes you want
		Quill.register(Size, true);

		var Font = Quill.import('formats/font');
		Font.whitelist = ['Arial', 'Georgia', 'Impact', 'Tahoma', 'Verdana'];
		Quill.register(Font, true);

		// Add custom header formats
		var Header = Quill.import('formats/header');
		Header.whitelist = [false, 1, 2, 3, 4]; // Allow header levels 1 to 4
		Quill.register(Header, true);

        function toggleHighlight(textContainer, keyword, highlightClass) {
			var spans = textContainer.querySelectorAll('.' + highlightClass);
			spans.forEach(function (span) {
				span.outerHTML = span.innerHTML;
			});

			var regex = new RegExp('(?<!\\w)' + escapeRegExp(keyword) + '(?!\\w)', 'giu');
			var text = textContainer.innerHTML;
			var highlightedText = text.replace(regex, function (match) {
				return '<span class="' + highlightClass + '">' + match + '</span>';
			});

			if (text === highlightedText) {
				highlightedText = text.replace(new RegExp('<span class="' + highlightClass + '">|<\/span>', 'gi'), '');
			}

			textContainer.innerHTML = highlightedText;
		}

        function toggleInstancesHighlight(keyword) {
            var transcribedDiv = quill.root;

            if (totalInstancesHighlighted) {
                var spans = transcribedDiv.querySelectorAll('.highlight-green');
                spans.forEach(function (span) {
                    span.outerHTML = span.innerHTML;
                });
            } else {
                toggleHighlight(transcribedDiv, keyword, 'highlight-green');
            }

            totalInstancesHighlighted = !totalInstancesHighlighted;
        }

        function togglePartialsHighlight(keyword) {
            var transcribedDiv = quill.root;

            if (partialMatchesHighlighted) {
                var spans = transcribedDiv.querySelectorAll('.highlight-yellow');
                spans.forEach(function (span) {
                    span.outerHTML = span.innerHTML;
                });
            } else {
                var escapedKeyword = escapeRegExp(keyword);
                var regex = new RegExp(`(?!\\b${escapedKeyword}\\b)[\\w\\u0600-\\u06FF]*${escapedKeyword}[\\w\\u0600-\\u06FF]*\\b`, 'gi');
                var text = transcribedDiv.innerHTML;
                var highlightedText = text.replace(regex, function (match) {
                    return '<span class="highlight-yellow">' + match + '</span>';
                });

                transcribedDiv.innerHTML = highlightedText;
            }

            partialMatchesHighlighted = !partialMatchesHighlighted;
        }

        function checkKeywords() {
            if (!validateKeywords()) {
				return;
			}
			
			var keywords = document.getElementById('keywords').value.split('\n').filter(Boolean);
            var textArea = quill.root.innerHTML;
            var text = textArea;
            var results = document.getElementById('results');
            results.innerHTML = '';

            keywords.forEach(function (keyword) {
                var regex = new RegExp('(?<!\\w)' + escapeRegExp(keyword) + '(?!\\w)', 'giu');
                var totalInstances = (text.match(regex) || []).length;
                var partialMatches = (text.match(new RegExp('(?<!\\w)' + escapeRegExp(keyword) + '\\w*', 'giu')) || []).length - totalInstances;

                var row = '<tr>';
                row += '<td class="keyword-cell">' + keyword + '</td>';
                row += '<td class="total-instances-cell" onclick="toggleInstancesHighlight(\'' + keyword + '\')">' + totalInstances + '</td>';
                row += '<td class="partial-matches-cell" onclick="togglePartialsHighlight(\'' + keyword + '\')">' + partialMatches + '</td>';
                row += '<td>' + ((totalInstances + partialMatches) / text.split(/\s+/).length * 100).toFixed(2) + '%</td>';
                row += '</tr>';

                results.innerHTML += row;
            });

            updateStats(); // Update stats after checking keywords
			adjustResultsContainerHeight();
        }

        function updateStats() {
            var keywords = document.getElementById('keywords').value.split('\n').filter(Boolean);
            var usedKeywords = 0;

            keywords.forEach(function (keyword) {
                var regex = new RegExp('(?<!\\w)' + escapeRegExp(keyword) + '(?!\\w)', 'giu');
                if (quill.root.innerHTML.match(regex)) {
                    usedKeywords++;
                }
            });

            var totalKeywords = keywords.length;
            var percentageKeywords = (usedKeywords / totalKeywords * 100).toFixed(2) + '%';
            var unusedKeywords = totalKeywords - usedKeywords;

            document.getElementById('totalKeywords').textContent = totalKeywords;
            document.getElementById('usedKeywords').textContent = usedKeywords;
            document.getElementById('percentageKeywords').textContent = percentageKeywords;
            document.getElementById('unusedKeywords').textContent = unusedKeywords;

            // Adjust the height of the results container
            adjustResultsContainerHeight();
        }

        function adjustResultsContainerHeight() {
            var resultsContainer = document.getElementById('resultsContainer');
            var resultsTable = document.getElementById('resultsTable');
            
            resultsContainer.style.height = resultsTable.clientHeight + 'px';
        }

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function toggleSticky() {
            var resultsContainer = document.querySelector('.results-container');
            var stickyButton = document.getElementById('sticky-button');

            if (stickyEnabled) {
                resultsContainer.classList.remove('sticky');
                stickyButton.textContent = 'Stick List';
            } else {
                resultsContainer.classList.add('sticky');
                stickyButton.textContent = 'Unstick List';
            }

            stickyEnabled = !stickyEnabled;
        }
		
		function toggleInstructions() {
			var instructions = document.getElementById('instructions');
			instructions.classList.toggle('show');
			
			var howToUseButton = document.querySelector('.how-to-use-button');
			howToUseButton.textContent = instructions.classList.contains('show') ? 'Hide Instructions' : 'How to use';
		}
		
		function returnToTop() {
			window.scrollTo({
				top: 0,
				behavior: 'smooth'
			});
		}
		
		 function returnToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Make the button sticky
        window.addEventListener('scroll', function () {
            var button = document.querySelector('.return-to-top-button');
            var keywordContainer = document.querySelector('.keyword-container');
            var keywordContainerRect = keywordContainer.getBoundingClientRect();

            if (window.scrollY > keywordContainerRect.bottom) {
                button.style.visibility = 'visible';
            } else {
                button.style.visibility = 'hidden';
            }
        });
		
		function clearResults() {
			var confirmDelete = confirm("Are you sure you want to delete everything?");

			if (confirmDelete) {
				var results = document.getElementById('results');
				results.innerHTML = '';

				// Clear Quill editor
				quill.root.innerHTML = '';

				// Clear keywords textarea
				document.getElementById('keywords').value = '';

				// Also update the stats after clearing results
				updateStats();

				// Adjust the height of the results container
				adjustResultsContainerHeight();
			}
		}
		
		function validateKeywords() {
			var keywordsInput = document.getElementById('keywords');
			var keywords = keywordsInput.value.split('\n').map(keyword => keyword.trim()).filter(Boolean);
			var hasEmptyKeyword = keywords.some(function(keyword) {
				return keyword === '';
			});



			var keywordsWithTrailingSpaces = keywordsInput.value.split('\n').filter(keyword => keyword.endsWith(' '));

			if (keywordsWithTrailingSpaces.length > 0) {
				var confirmFix = confirm("Some keywords have trailing spaces. Would you like to fix them?");
				if (confirmFix) {
					keywordsInput.value = keywords.join('\n');
				}
			}

			return true;
		}

    </script>
</body>

</html>